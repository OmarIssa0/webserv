#############################################
# GLOBAL TEST SERVER
#############################################

server {
    listen localhost:8080;
    server_name localhost;

    # Server level root
    # root ./www;

    #########################################
    # 200 OK — Normal Static Serving
    #########################################
    location / {
        index index.html;
    }

    #########################################
    # 200 OK — Location Root Override
    #########################################
    location /override-root {
        root ./www_override;
        index index.html;
    }

    #########################################
    # 301 Redirect — Return Without Root
    #########################################
    location /redirect301 {
        return 301 /;
    }

    #########################################
    # 302 Redirect — External Redirect
    #########################################
    location /redirect302 {
        return 302 https://example.com;
    }

    #########################################
    # 200 Return Text — No Root Required
    #########################################
    location /return-text {
        return 200 "HELLO_FROM_RETURN";
    }

    #########################################
    # 403 Forbidden Test
    #########################################
    location /forbidden {
        root ./forbidden_folder;
        autoindex off;
    }

    #########################################
    # Autoindex ON
    #########################################
    location /autoindex-on {
        root ./www;
        autoindex on;
    }

    #########################################
    # Autoindex OFF
    #########################################
    location /autoindex-off {
        root ./www;
        autoindex off;
    }

    #########################################
    # Upload Test — Body Handling
    #########################################
    location /upload {
        root ./uploads;
        upload_store ./uploads;
        client_max_body_size 5M;
    }

    #########################################
    # Small Body Limit — 413 Test
    #########################################
    location /small-body {
        root ./uploads;
        client_max_body_size 1K;
    }

    #########################################
    # DELETE Test
    #########################################
    location /delete {
        root ./uploads;
        methods GET POST DELETE;
    }

    #########################################
    # Method Restriction — 405 Test
    #########################################
    location /get-only {
        root ./www;
        methods GET;
    }

    #########################################
    # No Index + No Autoindex — 403 or 404
    #########################################
    location /noindex {
        root ./noindex_folder;
        autoindex off;
    }

    #########################################
    # CGI Test
    #########################################
    location /cgi-bin {
        root ./cgi-bin;
        cgi .py /usr/bin/python3;
    }

    #########################################
    # Header Stress Endpoint
    #########################################
    location /header-test {
        return 200 "HEADER_OK";
    }

}
