<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome</title>
</head>

<body>
    <h1>Welcome to the Web Server!</h1>
    <p>You have successfully logged in.</p>
    <a href="/logout">Logout</a>
    <div id="userDetails">
        <h2>User Details</h2>
        <p id="username">Username: </p>
        <p id="email">Email: </p>
    </div>
</body>
<script>
    // First try client-side stored username (set on login), fallback to server
    (function () {
        const stored = localStorage.getItem('username');
        if (stored) {
            document.getElementById('username').textContent += stored;
            return;
        }
        // Fallback: attempt to fetch from server-side endpoint
        fetch('/user-details')
            .then(response => {
                if (!response.ok) throw new Error('not ok');
                return response.json();
            })
            .then(data => {
                if (data.username)
                    document.getElementById('username').textContent += data.username;
                if (data.email)
                    document.getElementById('email').textContent += data.email;
            })
            .catch(error => console.error('Error fetching user details:', error));
    })();
</script>

</html>